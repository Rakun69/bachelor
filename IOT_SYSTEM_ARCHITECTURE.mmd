graph TD
    subgraph "Data Producers Layer"
        A1[IoT Sensor Node<br/>Environmental Data] --> D[Data Aggregation<br/>Gateway]
        A2[IoT Sensor Node<br/>Activity Monitoring] --> D
        A3[IoT Sensor Node<br/>Security Detection] --> D
        A4[IoT Sensor Node<br/>Environmental Control] --> D
        A5[IoT Sensor Node<br/>Safety Monitoring] --> D
        A6[IoT Sensor Node<br/>Behavioral Analytics] --> D
        A7[IoT Sensor Node<br/>External Conditions] --> D
    end

    subgraph "Privacy Processing Layer"
        D --> E[Continuous Data Stream<br/>Structured sensor readings]
        E --> F[Batch Formation<br/>Temporal data grouping]
        F --> G[Privacy Filter<br/>Sensitive data handling]
        G --> H[ZK Proof Generator<br/>Privacy-preserving validation]
        H --> I[Local Verifier<br/>Proof integrity check]
    end

    subgraph "Secure Communication Layer"
        I --> J[Encrypted Proof Batch<br/>Zero-knowledge packets]
        J --> K[Secure Transport<br/>Network transmission]
    end

    subgraph "Verification & Processing Layer"
        K --> L[Proof Receiver<br/>Batch collection]
        L --> M[Batch Verifier<br/>ZK proof validation]
        M --> N{Verification<br/>Status?}
        N -->|Valid| O[Data Acceptor<br/>Aggregated storage]
        N -->|Invalid| P[Rejection Handler<br/>Error processing]
    end

    subgraph "Service Delivery Layer"
        O --> Q[Privacy-Preserving Analytics<br/>Statistical aggregation]
        Q --> R[Insights Generator<br/>Pattern analysis]
        R --> S[Service Provider<br/>Value-added services]
    end

    %% Actor Interactions
    D -.-> T1["ðŸ“Š Multi-sensor data<br/>Heterogeneous readings<br/>Temporal patterns"]
    F -.-> T2["ðŸ“¦ Batch processing<br/>Configurable windows<br/>Scalable grouping"]
    H -.-> T3["ðŸ”’ Zero-knowledge proofs<br/>Data validity attestation<br/>Privacy preservation"]
    M -.-> T4["âœ… Cryptographic verification<br/>Mathematical certainty<br/>No data exposure"]

    %% Component Styling
    classDef producers fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef privacy fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef communication fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef verification fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef services fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef metadata fill:#f5f5f5,stroke:#616161,stroke-width:1px,stroke-dasharray: 3 3

    class A1,A2,A3,A4,A5,A6,A7 producers
    class D,E,F,G,H,I privacy
    class J,K communication
    class L,M,N,O,P verification
    class Q,R,S services
    class T1,T2,T3,T4 metadata